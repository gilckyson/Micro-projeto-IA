{% extends "base.html" %}
{% block title %}P√°gina Inicial{% endblock %}

{% block content %}
<h2 class="text-4xl mb-8 text-center text-gray-200 font-bold tracking-wide">
    Selecione o motivo da sua cat√°strofe pessoal
</h2>

<form action="/gerar" method="POST" id="form-desculpa"
      class="bg-gray-800 p-8 rounded-xl shadow-2xl border border-purple-700">

    <!-- CAMPO QUE O FASTAPI SEMPRE RECEBE -->
    <input type="hidden" name="motivo" id="motivo-final" value="">

    <label class="block text-xl font-medium text-purple-300 mb-3">
        O que voc√™ precisa desesperadamente desculpar?
    </label>

    <!-- SELECT (N√ÉO ENVIA DIRETO) -->
    <select id="motivo-select"
            class="w-full p-4 border border-gray-600 bg-gray-700 text-white rounded-lg text-lg"
            required>
        <option value="" disabled selected>Escolha um Motivo...</option>
        <option value="Atraso no trabalho ou compromisso">Atraso no trabalho ou compromisso</option>
        <option value="Comi o √∫ltimo peda√ßo de bolo">Comi o √∫ltimo peda√ßo de bolo</option>
        <option value="Quebrei um objeto de valor sentimental">Quebrei um objeto de valor sentimental</option>
        <option value="N√£o respondi a mensagem por 3 dias">N√£o respondi a mensagem por 3 dias</option>
        <option value="Outro">Outro (Especifique ‚Äì a IA se vira!)</option>
    </select>

    <!-- CAMPO EXTRA -->
    <div id="outro-container" class="mt-4 hidden">
        <label class="block text-xl font-medium text-purple-300 mb-2">
            Qual foi a cat√°strofe exata?
        </label>
        <input type="text" id="motivo-extra"
               class="w-full p-4 border border-gray-600 bg-gray-700 text-white rounded-lg text-lg"
               placeholder="Descreva o caos em detalhes...">
    </div>

    <!-- BOT√ÉO -->
    <button type="submit"
            id="btn-gerar"
            class="mt-6 w-full bg-pink-600 text-white p-4 rounded-lg text-xl font-bold
                   hover:bg-pink-700 transition duration-300 transform hover:scale-105">
        Gerar Desculpa C√≥smica ü™ê
    </button>

    <!-- LOADING -->
    <div id="loading" class="mt-6 text-center hidden">
        <p class="text-purple-400 text-lg font-semibold animate-pulse">
            A IA est√° vasculhando o cosmos, dobrando o espa√ßo-tempo e negociando com entidades ancestrais...
        </p>

        <div class="flex justify-center mt-4">
            <div class="h-10 w-10 border-4 border-purple-400 border-t-transparent rounded-full animate-spin"></div>
        </div>
    </div>

</form>
{% endblock %}

{% block scripts %}
<script>
const select = document.getElementById('motivo-select');
const outroContainer = document.getElementById('outro-container');
const motivoExtra = document.getElementById('motivo-extra');
const motivoFinal = document.getElementById('motivo-final');
const form = document.getElementById('form-desculpa');
const loading = document.getElementById('loading');
const botao = document.getElementById('btn-gerar');

select.addEventListener('change', () => {
    if (select.value === 'Outro') {
        outroContainer.classList.remove('hidden');
    } else {
        outroContainer.classList.add('hidden');
        motivoExtra.value = '';
    }
});

form.addEventListener('submit', (e) => {
    if (!select.value) {
        e.preventDefault();
        alert('Selecione um motivo.');
        return;
    }

    if (select.value === 'Outro') {
        motivoFinal.value =
            motivoExtra.value.trim() !== ''
                ? motivoExtra.value
                : 'Evento indefinido causado por for√ßas externas al√©m da compreens√£o humana';
    } else {
        motivoFinal.value = select.value;
    }

    // MOSTRA LOADING
    loading.classList.remove('hidden');
    botao.disabled = true;
    botao.classList.add('opacity-60', 'cursor-not-allowed');
});
</script>
{% endblock %}

